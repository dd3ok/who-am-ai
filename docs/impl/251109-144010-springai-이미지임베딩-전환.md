# Implement — Spring AI 이미지/임베딩 전환

## 변경 요약
- `GeminiAIFittingImageModel`이 Google GenAI HTTP API(`RestClient`)를 직접 호출하도록 재작성되어 `com.google.genai` SDK 의존성이 제거되었다.
- 레거시 임베딩 경로(`EmbeddingPort`, `GeminiApiEmbeddingAdapter`)와 `whoamai.legacy-embedding` 설정을 삭제해 Spring AI VectorStore가 기본 `EmbeddingModel` Bean만 사용하도록 정리했다.
- `GeminiConfig`(SDK Client Bean)을 제거해 Spring AI 자동 구성만으로 GenAI 연결 정보를 주입한다.

## Why / Scope
- Why: see: /docs/plan+design/251109-142019-springai-전체-전환보완.md — DoD(GenAI SDK 제거, Spring AI 기반 일원화)를 충족하여 유지보수 범위를 축소한다.
- Scope: 이미지 생성 어댑터, 임베딩 관련 레거시 어댑터/설정, `application.yml` 내 불필요한 토글 제거.

## Plan 대비 변경 사항 (Drift)
- Spring AI에서 공식 Google ImageModel Bean을 아직 제공하지 않아 HTTP 호출을 직접 구성했으며, 해당 사실과 예외 로깅을 코드/문서에 명시했다. (기능적 동등성은 유지)

## 코드 주요 포인트
- `src/main/kotlin/com/dd3ok/whoamai/adapter/out/gemini/GeminiAIFittingImageModel.kt`: RestClient 기반 POST(`/v1beta/models/{model}:generateContent`) 구현, 요청/응답 DTO 내장, inlineData Base64 추출 및 오류 로깅.
- `src/main/resources/application.yml`: `whoamai.legacy-embedding` 제거로 불필요한 토글 삭제.
- `src/main/kotlin/com/dd3ok/whoamai/common/config/GeminiConfig.kt`, `adapter/out/gemini/GeminiApiEmbeddingAdapter.kt`, `application/port/out/EmbeddingPort.kt`: 파일 삭제로 SDK Client 및 레거시 임베딩 레이어 제거.

## 배치/운영 플로우
- 애플리케이션 기동 시 Spring AI Chat/Embedding Bean만 사용하며, 이미지 경로는 동일 API Key(`spring.ai.google.genai.api-key`)를 사용해 REST 호출을 수행한다. 별도 배치나 토글 없음.

## 테스트 시나리오 & 예상 결과 (실행하지 않음)
- 시나리오 1: `/api/ai-fitting` PNG 요청 → RestClient 응답에서 inlineData 추출 성공, `Content-Type`이 설정된 MIME으로 반환.
- 시나리오 2: Google API 오류 발생 → `RestClientException` 로깅 후 Controller에서 500 응답, 재시도 시 정상 동작.
- 시나리오 3: 누락된 inlineData 응답 → `IllegalStateException` 발생 및 로그 남김, 클라이언트에 에러 전달되어 장애 인지 가능.

## 작업 체크리스트
- [✅] GenAI SDK Client 및 임베딩 레거시 레이어 제거
- [✅] RestClient 기반 Spring AI ImageModel 구현
- [✅] application.yml 불필요 설정 제거
- [✅] Plan 대비 Drift(HTTP 직접호출 사유) 기록
