# Plan+Design — Spring AI 이미지 경로 통합

## 목적 / 문제정의
- 현재 `GeminiAdapter.generateImageContent`가 Google GenAI SDK Client에 직접 의존해 Prompt/Config를 수동 구성한다.
- 텍스트 경로와 동일하게 Spring AI `ImageModel` 계층으로 통합해 설정 일관성, 에러 처리, 추상화 수준을 맞춘다.

## 범위(Scope)
- 포함: `GeminiAdapter` 이미지 경로를 Spring AI `ImageModel`/`ImageClient`로 교체, Prompt/옵션 매핑 정의, Config/Properties 정리.
- 제외: 이미지 생성 비즈니스 로직(예: AIFitting Prompt) 자체 변경, 새로운 이미지 모델 도입.

## 입력 / 출력 / 의존성
- 입력: 기존 `GeminiAdapter` 이미지 API 호출부, `GeminiImageModelProperties`, Spring AI Google GenAI Image 모듈.
- 출력: Spring AI `ImageResponse`를 도메인 값으로 매핑(현재는 `GenerateContentResponse`).
- 참조: Spring AI docs — `/spring-projects/spring-ai` (topic: google genai image).
- 환경: Spring Boot 3.5.7, Spring AI 1.1.0-M4, Google Imagen 3(API key 동일).

## 데이터 흐름(DFD) / 시퀀스
1. 애플리케이션 서비스가 `GeminiPort.generateImageContent` 호출.
2. Adapter가 전달받은 이미지 Part/Prompt를 Spring AI `ImagePrompt`로 변환.
3. `ImageModel.call` → `ImageResponse` 반환.
4. 도메인 계층에 Base64 또는 URL 전달, 실패 시 예외/에러 메시지.

## 설계(아키텍처 / 모듈 / 의존성)
- Bean: Spring AI auto-config에서 제공하는 `ImageModel` (google genai) 주입, 필요 시 옵션을 위한 `GoogleGenAiImageOptions`.
- Adapter:
  - `generateImageContent` 시, 입력 Part(현재 Google SDK 타입)를 Spring AI `BinaryContent` 등으로 변환.
  - Prompt 문자열은 기존 XML 지시어 재활용.
  - 응답은 `ImageResponse.getResults().first().output.content` (Base64) 형태로 매핑.
- Config:
  - `GeminiConfig`의 `Client` Bean 제거 가능, 단 다른 경로가 사용하지 않을 때.
  - `GeminiImageModelProperties`에 Spring AI 옵션(temperature, seed 등) 매핑.
- 포트 인터페이스 유지: 서명 변경 시 상위 서비스 영향 분석, 가능하면 동일 반환 타입 유지 후 내부 변환.

## 리스크 / 가정
- 리스크: Spring AI ImageModel이 현재 사용하는 고급 옵션(topP/topK 등) 전체를 지원하지 않을 수 있다.
- 리스크: 입력 Part를 Spring AI 포맷으로 변환하는 중 메모리 사용 증가 가능성.
- 가정: Spring AI Google 이미지 모듈에서 멀티파트 입력을 지원한다(지원하지 않으면 SDK 병행 필요 → Drift 기록).

## 완료 기준(DoD)
- `GeminiAdapter.generateImageContent`가 Spring AI ImageModel만 사용한다.
- `GeminiConfig`에서 Google SDK Client Bean 제거.
- Implement 문서에 Drift/테스트 시나리오 기록.
- 이미지 생성 요청 시 기능 회귀 없이 성공 로그 확인.

## Why / Scope 기록
- Why: LLM 텍스트·이미지 경로를 동일한 Spring AI 추상화로 묶어 구성 복잡도를 줄이고, 추후 모델 교체 시 모듈별 일관성을 확보한다.
- Scope 근거: 이미지 경로만 남은 단일 SDK 사용처이므로 해당 코드/설정만 수정하면 전체 통합이 완성된다.
